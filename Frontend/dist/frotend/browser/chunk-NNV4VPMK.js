import{a as G}from"./chunk-RLNHWRDG.js";import{a as U}from"./chunk-U6BUASLA.js";import{a as N}from"./chunk-M6GDLID5.js";import{B as r,Ca as O,F as f,G as k,Ha as H,K as P,O as v,P as e,Q as t,R as c,S as V,T as S,U as x,Y as i,Z as E,_ as h,g as D,h as w,ia as g,ja as b,m as I,p as M,r as C,s as _,sa as A,t as p,u,ua as j,va as z,xa as L}from"./chunk-AOLGXRAL.js";var T=class s{constructor(o){this.http=o}API_URL=H.apiUrl;getDashboardStats(){let o=new Date().toISOString().split("T")[0];return w({sales:this.http.get(`${this.API_URL}/Sale`),products:this.http.get(`${this.API_URL}/Product`),expenses:this.http.get(`${this.API_URL}/Expense`)}).pipe(D(({sales:a,products:n,expenses:d})=>{let y=a.filter(l=>new Date(l.saleDate).toISOString().split("T")[0]===o&&l.status==="Finalizada"),R=y.reduce((l,m)=>l+(m.totalAmount||0),0),F=y.length,$=y.reduce((l,m)=>{let q=m.totalAmount-m.totalAmount*.3;return l+(m.totalAmount-q)},0),J=n.filter(l=>l.stockQuantity<=(l.minStock||10)).length,Q=d.filter(l=>new Date(l.expenseDate).toISOString().split("T")[0]===o).reduce((l,m)=>l+(m.amount||0),0);return{totalSalesToday:R,salesCountToday:F,totalProfit:$,totalProducts:n.length,lowStockProducts:J,totalExpenses:Q}}))}static \u0275fac=function(a){return new(a||s)(M(L))};static \u0275prov=I({token:s,factory:s.\u0275fac,providedIn:"root"})};function X(s,o){s&1&&(e(0,"div",13),c(1,"div",14),t())}function Y(s,o){if(s&1){let a=V();e(0,"div",15)(1,"div",16),S("click",function(){C(a);let d=x();return _(d.goToPOS())}),e(2,"div",17)(3,"div")(4,"h3",18),i(5,"Punto de Venta"),t(),e(6,"p",19),i(7,"Realizar ventas"),t()(),p(),e(8,"svg",20),c(9,"path",21),t()(),u(),e(10,"button",22),i(11," Ir al POS "),t()(),e(12,"div",16),S("click",function(){C(a);let d=x();return _(d.goToProducts())}),e(13,"div",17)(14,"div")(15,"h3",18),i(16,"Productos"),t(),e(17,"p",19),i(18,"Gestionar inventario"),t()(),p(),e(19,"svg",20),c(20,"path",23),t()(),u(),e(21,"button",22),i(22," Ver Productos "),t()(),e(23,"div",16),S("click",function(){C(a);let d=x();return _(d.goToCash())}),e(24,"div",17)(25,"div")(26,"h3",18),i(27,"Caja"),t(),e(28,"p",19),i(29,"Control de efectivo"),t()(),p(),e(30,"svg",20),c(31,"path",24),t()(),u(),e(32,"button",25),i(33," Gestionar Caja "),t()()()}}function Z(s,o){s&1&&(e(0,"h2",26),i(1,"Estad\xEDsticas del D\xEDa"),t())}function ee(s,o){if(s&1&&(e(0,"div",27)(1,"div",28)(2,"div",29)(3,"span",30),i(4,"VENTAS DEL D\xCDA"),t(),p(),e(5,"svg",31),c(6,"path",32)(7,"path",33),t()(),u(),e(8,"h2",34),i(9),g(10,"number"),t(),e(11,"p",35),i(12),t()(),e(13,"div",36)(14,"div",29)(15,"span",30),i(16,"UTILIDAD"),t(),p(),e(17,"svg",31),c(18,"path",37),t()(),u(),e(19,"h2",34),i(20),g(21,"number"),t(),e(22,"p",35),i(23),t()(),e(24,"div",38)(25,"div",29)(26,"span",30),i(27,"PRODUCTOS"),t(),p(),e(28,"svg",31),c(29,"path",39),t()(),u(),e(30,"h2",34),i(31),t(),e(32,"p",35),i(33),t()(),e(34,"div",40)(35,"div",29)(36,"span",30),i(37,"GASTOS"),t(),p(),e(38,"svg",31),c(39,"path",41),t()(),u(),e(40,"h2",34),i(41),g(42,"number"),t(),e(43,"p",35),i(44),t()()()),s&2){let a=x();r(9),h("$",b(10,8,a.stats.totalSalesToday,"1.0-0")),r(3),h("",a.stats.salesCountToday," ventas realizadas"),r(8),h("$",b(21,11,a.stats.totalProfit,"1.0-0")),r(3),E(a.stats.totalProfit>0?"Ganancia estimada":"Sin datos"),r(8),E(a.stats.totalProducts),r(2),h("",a.stats.lowStockProducts," con stock bajo"),r(8),h("$",b(42,14,a.stats.totalExpenses,"1.0-0")),r(3),E(a.stats.totalExpenses>0?"Gastos del d\xEDa":"Sin gastos registrados")}}var B=class s{constructor(o,a,n,d){this.authService=o;this.cashService=a;this.dashboardService=n;this.router=d}currentUser=null;currentSession=null;stats={totalSalesToday:0,salesCountToday:0,totalProfit:0,totalProducts:0,lowStockProducts:0,totalExpenses:0};loading=!0;showCashSessionModal=!1;showNoCashModal=!1;ngOnInit(){this.currentUser=this.authService.currentUserValue,this.cashService.currentSession$.subscribe(o=>{this.currentSession=o,o?(this.showCashSessionModal=!0,this.showNoCashModal=!1):(this.showCashSessionModal=!1,this.showNoCashModal=!0)}),this.loadDashboardStats()}loadDashboardStats(){this.loading=!0,this.dashboardService.getDashboardStats().subscribe({next:o=>{this.stats=o,this.loading=!1},error:o=>{console.error("Error cargando estad\xEDsticas:",o),this.loading=!1}})}logout(){this.authService.logout()}goToPOS(){this.router.navigate(["/pos"])}goToProducts(){this.router.navigate(["/products"])}goToCash(){this.router.navigate(["/cash"])}static \u0275fac=function(a){return new(a||s)(f(U),f(G),f(T),f(O))};static \u0275cmp=k({type:s,selectors:[["app-dashboard"]],decls:23,vars:19,consts:[[1,"p-6"],[1,"mb-6"],[1,"text-3xl","font-bold","text-estanco-dark"],[1,"text-gray-600","mt-1"],[3,"closed","isOpen","title","type","confirmText"],[1,"text-gray-700"],[1,"text-2xl","font-bold","text-success","mt-2"],[1,"text-sm","text-gray-600","mt-3"],[3,"confirmed","closed","isOpen","title","type","confirmText","showCancelButton","cancelText"],["class","flex justify-center items-center py-12",4,"ngIf"],["class","grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",4,"ngIf"],["class","text-2xl font-bold text-estanco-dark mb-4",4,"ngIf"],["class","grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",4,"ngIf"],[1,"flex","justify-center","items-center","py-12"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-estanco"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6","mb-8"],[1,"card","cursor-pointer","hover:scale-105","transition-transform",3,"click"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-estanco-dark"],[1,"text-sm","text-gray-600"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-12","h-12","text-estanco"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"],[1,"btn-primary","w-full"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"],[1,"btn-secondary","w-full"],[1,"text-2xl","font-bold","text-estanco-dark","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-6"],[1,"stat-card-sales"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-white/80","text-sm","font-medium"],["fill","currentColor","viewBox","0 0 20 20",1,"w-8","h-8","text-white/60"],["d","M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z","clip-rule","evenodd"],[1,"text-3xl","font-bold","text-white","mb-1"],[1,"text-white/80","text-sm"],[1,"stat-card-profit"],["fill-rule","evenodd","d","M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z","clip-rule","evenodd"],[1,"stat-card-stock"],["d","M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"],[1,"stat-card-expenses"],["fill-rule","evenodd","d","M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11 4a1 1 0 10-2 0v4a1 1 0 102 0V7zm-3 1a1 1 0 10-2 0v3a1 1 0 102 0V8zM8 9a1 1 0 00-2 0v2a1 1 0 102 0V9z","clip-rule","evenodd"]],template:function(a,n){a&1&&(e(0,"div",0)(1,"div",1)(2,"h1",2),i(3,"Dashboard"),t(),e(4,"p",3),i(5),t()(),e(6,"app-modal",4),S("closed",function(){return n.showCashSessionModal=!1}),e(7,"p",5),i(8," Tienes una sesi\xF3n de caja abierta con un monto inicial de: "),t(),e(9,"p",6),i(10),g(11,"number"),t(),e(12,"p",7),i(13," Puedes comenzar a realizar ventas y operaciones. "),t()(),e(14,"app-modal",8),S("confirmed",function(){return n.goToCash()})("closed",function(){return n.showNoCashModal=!1}),e(15,"p",5),i(16," No hay una sesi\xF3n de caja abierta actualmente. "),t(),e(17,"p",7),i(18," Debes abrir una sesi\xF3n de caja antes de poder realizar ventas y operaciones. "),t()(),P(19,X,2,0,"div",9)(20,Y,34,0,"div",10)(21,Z,2,0,"h2",11)(22,ee,45,17,"div",12),t()),a&2&&(r(5),h("Bienvenido, ",n.currentUser==null?null:n.currentUser.email),r(),v("isOpen",n.showCashSessionModal)("title","Sesi\xF3n de Caja Abierta")("type","success")("confirmText","Entendido"),r(4),h(" $",b(11,16,n.currentSession==null?null:n.currentSession.openingAmount,"1.0-0")," "),r(4),v("isOpen",n.showNoCashModal)("title","Sin Sesi\xF3n de Caja")("type","warning")("confirmText","Ir a Caja")("showCancelButton",!0)("cancelText","Ahora no"),r(5),v("ngIf",n.loading),r(),v("ngIf",!n.loading),r(),v("ngIf",!n.loading),r(),v("ngIf",!n.loading))},dependencies:[z,A,N,j],styles:["[_nghost-%COMP%]{display:block}"]})};export{B as DashboardComponent};
