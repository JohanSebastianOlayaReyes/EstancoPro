import{a as R}from"./chunk-VKTQXDN4.js";import{a as $}from"./chunk-RLNHWRDG.js";import{a as H}from"./chunk-U6BUASLA.js";import{b as N,d as G,f as L,h as z,n as U,p as P}from"./chunk-VMEROYEQ.js";import{a as W}from"./chunk-M6GDLID5.js";import{B as r,Ca as F,F as C,G as I,K as g,O as l,P as t,Q as i,R as f,S as E,T as v,U as u,Y as s,Z as h,_ as m,aa as w,ba as M,ca as A,fa as T,ia as d,ja as c,qa as k,r as b,ra as j,s as y,sa as B,t as x,ta as D,u as _,ua as O,va as V}from"./chunk-AOLGXRAL.js";var J=(a,n)=>({"bg-success/10 border border-success text-success":a,"bg-warning/10 border border-warning text-warning":n});function K(a,n){a&1&&(t(0,"div",38)(1,"div",39),x(),t(2,"svg",40),f(3,"path",36),i(),_(),t(4,"span",26),s(5,"Caja Abierta"),i()()())}function Q(a,n){if(a&1){let e=E();t(0,"button",41),v("click",function(){b(e);let p=u();return y(p.openOpenSessionModal())}),x(),t(1,"svg",42),f(2,"path",43),i(),s(3," Abrir Caja "),i()}}function X(a,n){if(a&1){let e=E();t(0,"button",44),v("click",function(){b(e);let p=u();return y(p.openCloseSessionModal())}),x(),t(1,"svg",42),f(2,"path",45),i(),s(3," Cerrar Caja "),i()}}function Y(a,n){if(a&1&&(t(0,"div",46)(1,"div",47)(2,"div")(3,"h3",48),s(4,"Sesi\xF3n Actual"),i(),t(5,"p",49),s(6),d(7,"date"),i()(),t(8,"div",50)(9,"p",51),s(10,"Monto Inicial"),i(),t(11,"p",52),s(12),d(13,"number"),i()()()()),a&2){let e=u();r(6),m("Apertura: ",c(7,2,e.currentSession.openedAt,"dd/MM/yyyy HH:mm")),r(6),m("$",c(13,5,e.currentSession.openingAmount,"1.0-0"))}}function Z(a,n){a&1&&(t(0,"div",53),f(1,"div",54),i())}function ee(a,n){a&1&&(t(0,"div",58),x(),t(1,"svg",59),f(2,"path",60),i(),_(),t(3,"p",61),s(4,"No hay sesiones registradas"),i(),t(5,"p",62),s(6,"Abre una nueva sesi\xF3n de caja para comenzar"),i()())}function te(a,n){if(a&1&&(t(0,"div")(1,"p",69),s(2,"Cierre"),i(),t(3,"p",74),s(4),d(5,"number"),i()()),a&2){let e=u().$implicit;r(4),m("$",c(5,1,e.closingAmount,"1.0-0"))}}function ie(a,n){if(a&1){let e=E();t(0,"div",63),v("click",function(){let p=b(e).$implicit,S=u(2);return y(S.viewSessionDetails(p))}),t(1,"div",47)(2,"div",64)(3,"div",65)(4,"span",66),s(5),i(),t(6,"span",67),s(7),d(8,"date"),i()()(),t(9,"div",68)(10,"div")(11,"p",69),s(12,"Apertura"),i(),t(13,"p",70),s(14),d(15,"number"),i()(),g(16,te,6,4,"div",71),i(),x(),t(17,"svg",72),f(18,"path",73),i()()()}if(a&2){let e=n.$implicit,o=u(2);r(4),l("ngClass",o.getSessionStatusClass(e)),r(),m(" ",o.getSessionStatus(e)," "),r(2),h(c(8,5,e.openedAt,"dd/MM/yyyy HH:mm")),r(7),m("$",c(15,8,e.openingAmount,"1.0-0")),r(2),l("ngIf",e.closedAt)}}function ne(a,n){if(a&1&&(t(0,"div",17)(1,"h2",55),s(2,"Historial de Sesiones"),i(),g(3,ee,7,0,"div",56)(4,ie,19,11,"div",57),i()),a&2){let e=u();r(3),l("ngIf",e.sessions.length===0),r(),l("ngForOf",e.sessions)}}function se(a,n){if(a&1&&(t(0,"div",75)(1,"div",39),x(),t(2,"svg",40),f(3,"path",76),i(),_(),t(4,"span",26),s(5),d(6,"number"),d(7,"number"),i()()()),a&2){let e=u();l("ngClass",T(8,J,e.calculateDifference()===0,e.calculateDifference()!==0)),r(5),m(" ",e.calculateDifference()===0?"Cuadre perfecto":e.calculateDifference()>0?"Sobrante: $"+c(6,2,e.calculateDifference(),"1.0-0"):"Faltante: $"+c(7,5,e.Math.abs(e.calculateDifference()),"1.0-0")," ")}}function ae(a,n){if(a&1&&(t(0,"div")(1,"p",69),s(2,"Fecha Cierre"),i(),t(3,"p",26),s(4),d(5,"date"),i()()),a&2){let e=u(2);r(4),h(c(5,1,e.selectedSession.closedAt,"dd/MM/yyyy HH:mm"))}}function oe(a,n){if(a&1&&(t(0,"div")(1,"p",69),s(2,"Monto Cierre"),i(),t(3,"p",85),s(4),d(5,"number"),i()()),a&2){let e=u(2);r(4),m("$",c(5,1,e.selectedSession.closingAmount,"1.0-0"))}}function re(a,n){a&1&&(t(0,"div",86),f(1,"div",87),i())}function le(a,n){a&1&&(t(0,"div",88),s(1," No hay ventas registradas "),i())}function de(a,n){if(a&1&&(t(0,"div",93)(1,"div")(2,"p",94),s(3),i(),t(4,"p",95),s(5),d(6,"date"),i()(),t(7,"p",96),s(8),d(9,"number"),i()()),a&2){let e=n.$implicit;r(3),m("Venta #",e.id),r(2),h(c(6,3,e.saleDate,"HH:mm")),r(3),m("$",c(9,6,e.totalAmount,"1.0-0"))}}function ce(a,n){if(a&1&&(t(0,"div",89),g(1,de,10,9,"div",90),t(2,"div",91)(3,"span",26),s(4,"Total Ventas:"),i(),t(5,"span",92),s(6),d(7,"number"),i()()()),a&2){let e=u(2);r(),l("ngForOf",e.sessionSales),r(5),m("$",c(7,2,e.calculateTotalSales(),"1.0-0"))}}function pe(a,n){if(a&1&&(t(0,"div",17)(1,"div",77)(2,"div")(3,"p",69),s(4,"Estado"),i(),t(5,"span",66),s(6),i()(),t(7,"div")(8,"p",69),s(9,"Usuario"),i(),t(10,"p",26),s(11),i()()(),t(12,"div",78)(13,"div",79)(14,"div")(15,"p",69),s(16,"Fecha Apertura"),i(),t(17,"p",26),s(18),d(19,"date"),i()(),g(20,ae,6,4,"div",71),i(),t(21,"div",77)(22,"div")(23,"p",69),s(24,"Monto Apertura"),i(),t(25,"p",80),s(26),d(27,"number"),i()(),g(28,oe,6,4,"div",71),i()(),t(29,"div",78)(30,"h4",81),s(31,"Ventas de la Sesi\xF3n"),i(),g(32,re,2,0,"div",82)(33,le,2,0,"div",83)(34,ce,8,5,"div",84),i()()),a&2){let e=u();r(5),l("ngClass",e.getSessionStatusClass(e.selectedSession)),r(),m(" ",e.getSessionStatus(e.selectedSession)," "),r(5),h(e.currentUser==null?null:e.currentUser.email),r(7),h(c(19,10,e.selectedSession.openedAt,"dd/MM/yyyy HH:mm")),r(2),l("ngIf",e.selectedSession.closedAt),r(6),m("$",c(27,13,e.selectedSession.openingAmount,"1.0-0")),r(2),l("ngIf",e.selectedSession.closedAt),r(4),l("ngIf",e.loadingSales),r(),l("ngIf",!e.loadingSales&&e.sessionSales.length===0),r(),l("ngIf",!e.loadingSales&&e.sessionSales.length>0)}}var q=class a{constructor(n,e,o,p){this.router=n;this.authService=e;this.cashService=o;this.saleService=p}Math=Math;currentUser=null;currentSession=null;sessions=[];sessionSales=[];loading=!0;loadingSales=!1;processingAction=!1;showOpenModal=!1;openingAmount=0;openingObservations="";showCloseModal=!1;closingAmount=0;closingObservations="";showDetailsModal=!1;selectedSession=null;showSuccessModal=!1;successMessage="";ngOnInit(){this.currentUser=this.authService.currentUserValue,this.cashService.currentSession$.subscribe(n=>{this.currentSession=n}),this.loadSessions()}loadSessions(){this.loading=!0,this.cashService.getAll().subscribe({next:n=>{this.sessions=n.sort((e,o)=>new Date(o.openedAt).getTime()-new Date(e.openedAt).getTime()),this.loading=!1},error:n=>{console.error("Error loading sessions:",n),this.loading=!1}})}openOpenSessionModal(){this.openingAmount=0,this.openingObservations="",this.showOpenModal=!0}openSession(){if(this.openingAmount<0){alert("El monto de apertura debe ser mayor o igual a cero");return}this.processingAction=!0,this.cashService.openSessionSimple(this.openingAmount).subscribe({next:n=>{this.processingAction=!1,this.showOpenModal=!1,this.successMessage="Sesi\xF3n de caja abierta exitosamente",this.showSuccessModal=!0,this.currentSession=n,this.loadSessions()},error:n=>{console.error("Error opening session:",n),alert("Error al abrir sesi\xF3n: "+(n.error?.message||"Error desconocido")),this.processingAction=!1}})}openCloseSessionModal(){if(!this.currentSession){alert("No hay una sesi\xF3n abierta para cerrar");return}this.closingAmount=0,this.closingObservations="",this.loadSessionSales(),this.showCloseModal=!0}loadSessionSales(){!this.currentSession||!this.currentSession.id||(this.loadingSales=!0,this.saleService.getByCashSession(this.currentSession.id).subscribe({next:n=>{this.sessionSales=n.filter(e=>e.status==="Finalizada"),this.loadingSales=!1},error:n=>{console.error("Error loading sales:",n),this.loadingSales=!1}}))}closeSession(){if(!this.currentSession)return;if(this.closingAmount<0){alert("El monto de cierre debe ser mayor o igual a cero");return}this.processingAction=!0;let n={closingAmount:this.closingAmount};this.cashService.close(this.currentSession.id,n).subscribe({next:()=>{this.processingAction=!1,this.showCloseModal=!1,this.successMessage="Sesi\xF3n de caja cerrada exitosamente",this.showSuccessModal=!0,this.currentSession=null,this.loadSessions()},error:e=>{console.error("Error closing session:",e),alert("Error al cerrar sesi\xF3n: "+(e.error?.message||"Error desconocido")),this.processingAction=!1}})}viewSessionDetails(n){n.id&&(this.selectedSession=n,this.showDetailsModal=!0,this.loadingSales=!0,this.saleService.getByCashSession(n.id).subscribe({next:e=>{this.sessionSales=e.filter(o=>o.status==="Finalizada"),this.loadingSales=!1},error:e=>{console.error("Error loading sales:",e),this.loadingSales=!1}}))}calculateTotalSales(){return this.sessionSales.reduce((n,e)=>n+e.totalAmount,0)}calculateExpectedClosing(){return this.currentSession?this.currentSession.openingAmount+this.calculateTotalSales():0}calculateDifference(){return this.closingAmount-this.calculateExpectedClosing()}getSessionStatus(n){return n.id===this.currentSession?.id?"Abierta":n.closedAt?"Cerrada":"Inactiva"}getSessionStatusClass(n){let e=this.getSessionStatus(n);return e==="Abierta"?"bg-success/10 text-success":e==="Cerrada"?"bg-gray-100 text-gray-600":"bg-warning/10 text-warning"}goBack(){this.router.navigate(["/dashboard"])}static \u0275fac=function(e){return new(e||a)(C(F),C(H),C($),C(R))};static \u0275cmp=I({type:a,selectors:[["app-cash"]],decls:68,vars:45,consts:[[1,"min-h-screen","bg-bg-green","p-6"],[1,"max-w-7xl","mx-auto"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-4"],[1,"text-gray-600","hover:text-estanco","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"text-3xl","font-bold","text-estanco-dark"],[1,"text-gray-600","mt-1"],[1,"flex","items-center","gap-3"],["class","bg-success/10 border border-success text-success px-4 py-2 rounded-lg",4,"ngIf"],["class","btn-primary flex items-center gap-2",3,"click",4,"ngIf"],["class","btn-danger flex items-center gap-2",3,"click",4,"ngIf"],["class","card mb-6 bg-gradient-to-br from-estanco to-estanco-dark text-white",4,"ngIf"],["class","flex justify-center items-center py-12",4,"ngIf"],["class","space-y-4",4,"ngIf"],[3,"confirmed","closed","isOpen","title","type","confirmText","showCancelButton","cancelText"],[1,"space-y-4"],[1,"label"],[1,"relative"],[1,"absolute","left-3","top-1/2","-translate-y-1/2","text-gray-500"],["type","number","min","0","step","1000","placeholder","0",1,"input","pl-8",3,"ngModelChange","ngModel","disabled"],[1,"text-xs","text-gray-500","mt-1"],[1,"bg-gray-50","rounded-lg","p-4","space-y-2"],[1,"flex","justify-between","text-sm"],[1,"text-gray-600"],[1,"font-semibold"],[1,"font-semibold","text-success"],[1,"border-t","border-gray-200","pt-2","flex","justify-between"],[1,"text-lg","font-bold","text-estanco"],["type","number","min","0","step","1000","placeholder","0",1,"input","pl-8",3,"ngModelChange","input","ngModel","disabled"],["class","p-3 rounded-lg",3,"ngClass",4,"ngIf"],[3,"closed","isOpen","title","type","confirmText"],[1,"text-center","py-4"],[1,"w-16","h-16","bg-success/10","rounded-full","mx-auto","mb-4","flex","items-center","justify-center"],["fill","currentColor","viewBox","0 0 20 20",1,"w-10","h-10","text-success"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],[1,"text-lg","font-semibold","text-gray-800"],[1,"bg-success/10","border","border-success","text-success","px-4","py-2","rounded-lg"],[1,"flex","items-center","gap-2"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5"],[1,"btn-primary","flex","items-center","gap-2",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"btn-danger","flex","items-center","gap-2",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"card","mb-6","bg-gradient-to-br","from-estanco","to-estanco-dark","text-white"],[1,"flex","items-center","justify-between"],[1,"text-xl","font-bold","mb-2"],[1,"text-mint","text-sm"],[1,"text-right"],[1,"text-mint","text-sm","mb-1"],[1,"text-3xl","font-bold"],[1,"flex","justify-center","items-center","py-12"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-estanco"],[1,"text-2xl","font-bold","text-estanco-dark","mb-4"],["class","card text-center py-12",4,"ngIf"],["class","card hover:shadow-green-md transition-all cursor-pointer",3,"click",4,"ngFor","ngForOf"],[1,"card","text-center","py-12"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-16","h-16","mx-auto","mb-4","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"],[1,"text-lg","font-medium","text-gray-600"],[1,"text-sm","text-gray-500","mt-2"],[1,"card","hover:shadow-green-md","transition-all","cursor-pointer",3,"click"],[1,"flex-1"],[1,"flex","items-center","gap-3","mb-2"],[1,"px-3","py-1","rounded-full","text-sm","font-medium",3,"ngClass"],[1,"text-sm","text-gray-600"],[1,"grid","grid-cols-2","gap-6","text-right"],[1,"text-xs","text-gray-600","mb-1"],[1,"text-lg","font-bold","text-success"],[4,"ngIf"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-gray-400","ml-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"text-lg","font-bold","text-error"],[1,"p-3","rounded-lg",3,"ngClass"],["fill-rule","evenodd","d","M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule","evenodd"],[1,"grid","grid-cols-2","gap-4"],[1,"border-t","border-gray-200","pt-4"],[1,"grid","grid-cols-2","gap-4","mb-4"],[1,"text-xl","font-bold","text-success"],[1,"font-semibold","mb-3"],["class","flex justify-center py-4",4,"ngIf"],["class","text-center py-4 text-gray-500",4,"ngIf"],["class","space-y-2",4,"ngIf"],[1,"text-xl","font-bold","text-error"],[1,"flex","justify-center","py-4"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-estanco"],[1,"text-center","py-4","text-gray-500"],[1,"space-y-2"],["class","flex justify-between items-center py-2 border-b border-gray-100",4,"ngFor","ngForOf"],[1,"pt-2","flex","justify-between","items-center"],[1,"text-xl","font-bold","text-lime"],[1,"flex","justify-between","items-center","py-2","border-b","border-gray-100"],[1,"text-sm","font-medium"],[1,"text-xs","text-gray-500"],[1,"font-bold","text-lime"]],template:function(e,o){e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),v("click",function(){return o.goBack()}),x(),t(5,"svg",5),f(6,"path",6),i()(),_(),t(7,"div")(8,"h1",7),s(9,"Gesti\xF3n de Caja"),i(),t(10,"p",8),s(11,"Control de sesiones de caja y movimientos"),i()()(),t(12,"div",9),g(13,K,6,0,"div",10)(14,Q,4,0,"button",11)(15,X,4,0,"button",12),i()(),g(16,Y,14,8,"div",13)(17,Z,2,0,"div",14)(18,ne,5,2,"div",15),i()(),t(19,"app-modal",16),v("confirmed",function(){return o.openSession()})("closed",function(){return o.showOpenModal=!1}),t(20,"div",17)(21,"div")(22,"label",18),s(23,"Monto Inicial *"),i(),t(24,"div",19)(25,"span",20),s(26,"$"),i(),t(27,"input",21),A("ngModelChange",function(S){return M(o.openingAmount,S)||(o.openingAmount=S),S}),i()(),t(28,"p",22),s(29,"Monto con el que se abre la caja"),i()()()(),t(30,"app-modal",16),v("confirmed",function(){return o.closeSession()})("closed",function(){return o.showCloseModal=!1}),t(31,"div",17)(32,"div",23)(33,"div",24)(34,"span",25),s(35,"Monto Inicial:"),i(),t(36,"span",26),s(37),d(38,"number"),i()(),t(39,"div",24)(40,"span",25),s(41,"Ventas del D\xEDa:"),i(),t(42,"span",27),s(43),d(44,"number"),i()(),t(45,"div",28)(46,"span",26),s(47,"Efectivo Esperado:"),i(),t(48,"span",29),s(49),d(50,"number"),i()()(),t(51,"div")(52,"label",18),s(53,"Efectivo en Caja *"),i(),t(54,"div",19)(55,"span",20),s(56,"$"),i(),t(57,"input",30),A("ngModelChange",function(S){return M(o.closingAmount,S)||(o.closingAmount=S),S}),v("input",function(){return o.calculateDifference()}),i()()(),g(58,se,8,11,"div",31),i()(),t(59,"app-modal",32),v("closed",function(){return o.showDetailsModal=!1}),g(60,pe,35,16,"div",15),i(),t(61,"app-modal",32),v("closed",function(){return o.showSuccessModal=!1,o.loadSessions()}),t(62,"div",33)(63,"div",34),x(),t(64,"svg",35),f(65,"path",36),i()(),_(),t(66,"p",37),s(67),i()()()),e&2&&(r(13),l("ngIf",o.currentSession),r(),l("ngIf",!o.currentSession),r(),l("ngIf",o.currentSession),r(),l("ngIf",o.currentSession),r(),l("ngIf",o.loading),r(),l("ngIf",!o.loading),r(),l("isOpen",o.showOpenModal)("title","Abrir Sesi\xF3n de Caja")("type","info")("confirmText",o.processingAction?"Abriendo...":"Abrir Caja")("showCancelButton",!0)("cancelText","Cancelar"),r(8),w("ngModel",o.openingAmount),l("disabled",o.processingAction),r(3),l("isOpen",o.showCloseModal)("title","Cerrar Sesi\xF3n de Caja")("type","warning")("confirmText",o.processingAction?"Cerrando...":"Cerrar Caja")("showCancelButton",!0)("cancelText","Cancelar"),r(7),m("$",c(38,36,o.currentSession==null?null:o.currentSession.openingAmount,"1.0-0")),r(6),m("$",c(44,39,o.calculateTotalSales(),"1.0-0")),r(6),m("$",c(50,42,o.calculateExpectedClosing(),"1.0-0")),r(8),w("ngModel",o.closingAmount),l("disabled",o.processingAction),r(),l("ngIf",o.closingAmount>0),r(),l("isOpen",o.showDetailsModal)("title","Detalles de Sesi\xF3n")("type","info")("confirmText","Cerrar"),r(),l("ngIf",o.selectedSession),r(),l("isOpen",o.showSuccessModal)("title","Operaci\xF3n Exitosa")("type","success")("confirmText","Aceptar"),r(6),h(o.successMessage))},dependencies:[V,k,j,B,P,N,z,G,U,L,W,O,D],styles:["[_nghost-%COMP%]{display:block;min-height:100vh}"]})};export{q as CashComponent};
