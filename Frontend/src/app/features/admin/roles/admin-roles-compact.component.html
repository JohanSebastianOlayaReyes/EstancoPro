<div class="admin-container">
  <app-sidebar-menu [sections]="menuSections"></app-sidebar-menu>
  <div class="admin-content">
    <div class="section-title header-with-controls">
      <h1>Gestión de Roles</h1>

      <div class="header-controls">
        <app-input id="search" placeholder="Buscar roles" [value]="searchTerm()" (valueChange)="searchTerm.set($any($event))"></app-input>
        <select class="filter-select" [value]="filterActive()" (change)="filterActive.set($any($event.target).value)">
          <option value="all">Todos</option>
          <option value="active">Activos</option>
          <option value="inactive">Inactivos</option>
        </select>
        <app-button variant="primary" (clicked)="toggleForm()">{{ showForm() ? 'Cancelar' : '+ Nuevo Rol' }}</app-button>
      </div>
    </div>

    <div *ngIf="error()" class="alert error">{{ error() }}</div>
    <div *ngIf="success()" class="alert success">{{ success() }}</div>

        <div class="roles-grid">
          <div *ngFor="let r of filteredRoles()" class="role-card">
        <h4>{{ r.typeRol }}</h4>
        <p class="desc">{{ r.description }}</p>
        <div class="card-actions">
          <app-button size="sm" variant="ghost" (clicked)="editRol(r)">Editar</app-button>
          <app-button size="sm" variant="destructive" (clicked)="deleteRol(r.id!)">Eliminar</app-button>
        </div>
      </div>
    </div>

    <!-- Modal for create/edit -->
    <div *ngIf="showForm()" class="modal-overlay">
      <div class="modal-backdrop" (click)="cancelForm()"></div>
      <div class="modal-window">
        <div class="modal-header">
          <h3>{{ editingId() ? 'Editar Rol' : 'Crear Rol' }}</h3>
          <app-button variant="ghost" (clicked)="cancelForm()">Cerrar</app-button>
        </div>
        <form (submit)="saveRol($event)" class="compact-form">
          <app-input id="typeRol" label="Nombre" [value]="form().typeRol" (valueChange)="updateForm('typeRol', $any($event))" [required]="true"></app-input>
          <app-input id="description" label="Descripción" [value]="form().description" (valueChange)="updateForm('description', $any($event))"></app-input>
          <div class="modal-actions">
            <app-button type="button" variant="ghost" (clicked)="cancelForm()">Cancelar</app-button>
            <app-button type="submit" variant="primary" [loading]="loading()">{{ editingId() ? 'Guardar' : 'Crear' }}</app-button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
